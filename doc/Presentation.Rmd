---
title: "Analysis of prostate cancer data"
author: "Group 5: Signe Marcussen, Lucille Augusta Green, Guangya Shen, Huijiao Yang"
date: "11th May 2021"
output: ioslides_presentation
---

  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, echo = FALSE, message = FALSE}
library("tidyverse")
library("knitr")
library("kableExtra")
library("here") # sets path to top level of the project
```

```{r, message = FALSE}
log_mod_treatment <- read_tsv(file = here("results/log_mod_treatment.tsv.gz"))
```


## Outline
#### Introduction

#### Materials
- <font size="3">Description of data set</font> 

#### Methods
- <font size="3">Data cleaning and wrangling</font>
- <font size="3">Vizualization</font>
- <font size="3">Modelling</font>

#### Results 
- <font size="3">Data visualization</font>
- <font size="3">Logistic regression</font>
- <font size="3">PCA</font>
- <font size="3">K-means clustering</font>

#### Discussion and Conclusion

# Introduction

## Introduction
- Prostate cancer data set from Andrews DF and Herzberg AM (1985) 
- Compare four different treatments
- 502 observations of 18 variables
- 27 NA values

# Materials | The data set

## The Raw Data set
```{r}
Variables <- c("patno", 
               "rx", 
               "status", 
               "pf",
               "bm",
               "hx", 
               "ekg" )

Description <- c("Patient number", 
                 "Dosage of estrogen treatment in mg", 
                 "Status of the patient, alive or or cause of death", 
                 "Activity level based on time in bed",
                 "The presence of Bone Metastases",
                 "History of Cardiovascular Disease", 
                 "Electrocardiography")

Levels <- c("-",
            "Placebo, 0.2 mg, 1.0 mg, 5.0 mg",
            "alive, dead - prostatic ca, dead - heart or vascular, dead - cerebrovascular, dead - pulmonary embolus, dead - other ca, dead - respiratory disease, dead - other specific non-ca, dead - unspecified non-ca, dead - unknown cause",
            "normal activity, in bed < 50% daytime, in bed > 50% daytime, confined to bed",
            "Yes/No", 
            "Yes/No",
            "normal, benign, rhythmic disturb & electrolyte ch, heart block or conduction def, heart strain, old MI, recent MI")

table <- cbind(Variables, 
               Description, 
               Levels)

table %>% 
  kable(caption = "Variables in the data set, 1/2",
        format = "html",
        col.names = c("Variable Name", 
                      "Desription", 
                      "Level / Summary Statistic")) %>% 
  kable_styling("striped", font_size = 13)
```

## The Data set
```{r}
Variables <- c("stage",
               "age",
               "wt",
               "sbp",
               "dbp",
               "hg",
               "sz",
               "ap",
               "sdate",
               "sg",
               "dtime")

Description <- c("Stage of prostate cancer",
                 "Age of patient in years",
                 "Weight Index = wt(kg)-ht(cm)+200",
                 "Systolic Blood Pressure/10",
                 "Diastolic Blood Pressure/10",
                 "Serum Hemoglobin [g/100ml]",
                 "Size of Primary Tumor [cm^2]",
                 "Serum Prostatic Acid Phosphatase",
                 "Date of study",
                 "Combined Index of Stage and Hist. Grade",
                 "Months of Follow-up")

Statistics <- c( " 3 or 4",
                 "71.51 (48.00 ~ 89.00)", 
                 "98.93 (69.00 ~ 152.00)",
                 "14.35 (8.00 ~ 30.00)",
                 "8.15 (4.00 ~ 18.00)",
                 "13.45 (5.90 ~ 21.20)",
                 "14.57 (0.00 ~ 69.00)",
                 "12.18 (0.01 ~ 999.88)",
                 " - ",
                 " - ",
                 " - ")

table <- cbind(Variables, 
               Description, 
               Statistics)
table %>% 
  kable(caption = "Variables in the data set, 2/2",
        format = "html",
        col.names = c("Variable Name", 
                      "Desription", 
                      "Level / Summary Statistic")) %>% 
  kable_styling("striped", 
                font_size = 13)
```

# Methods

## Methods, Data cleaning and wrangling
#### **Raw data to Clean data**
* Exclude *dtime*, *sdate* and *sg*
* Renaming variables 

#### **Clean data to Augment data**
* Add five new variables: 
  + <font size="4">outcome = mutating *status* into alive vs dead</font> 
  + <font size="4">treatment_mg = making a numeric variable by removing string </font>
  + <font size="4">EKG_lvl = creating a factorized variable with the levels in numbers </font>
  + <font size="4">performance_lvl = creating a factorized variable with the levels in numbers </font>
  + <font size="4">age_group = forming two age groups young/old based on the mean </font>
 

## Methods | Visualization of pre-treatment variables - Numeric

```{r, echo = FALSE, out.width="100%"}
include_graphics(here("results/04_plot_preTreatContinuous.png"))
```

## Methods | Visualization of pre-treatment variables - Categorical

```{r, echo = FALSE, out.width="100%"}
include_graphics(here("results/04_plot_preTreatCategorical.png"))
```

## Methods | Visualization of pre-treatment variables - Heatmap

```{r, echo = FALSE, out.width="70%", fig.align = "center"}
include_graphics(here("results/04_plot_preTreatHeatmap.png"))
```

## Methods | Modelling

- Logistic regression
- PCA
- K-means clustering


# Results

## Results | Treatment, outcome and age

```{r, echo = FALSE, out.width="90%", fig.align = "center"}
include_graphics(here("results/04_plot_OutcomeTreatment.png"))
```

## Results | Logistic model - Outcome as function of treatment

Output:
```{r, echo = TRUE}
log_mod_treatment
```

## Results | Logistic model for each variable - Treatment = 1.0 mg

```{r, echo = FALSE, out.width="100%"}
include_graphics(here("results/05_plot_Manhattan.png"))
```

## Results | Logistic model for each variable - Treatment = 1.0 mg
  
```{r, echo = FALSE, out.width="90%"}
include_graphics(here("results/05_plot_CIeffects.png"))
```

## Results | Distribution of significant variables for each outcome
```{r, echo = FALSE, out.width="100%"}
include_graphics(here("results/04_plot_significantVariables.png"))
```


## Results | Principal Component Analysis

## Results | Principal Component Analysis
```{r, echo = FALSE, out.width="90%"}
include_graphics(here("results/06_plot_PCA_PCcoords.png"))
```

## Results | Principal Component Analysis
```{r, echo = FALSE, out.width="90%"}
include_graphics(here("results/06_plot_PCA_rotation.png"))
```

## Results | Principal Component Analysis
```{r, echo = FALSE, out.width="90%"}
include_graphics(here("results/06_plot_PCA_varExpl.png"))
``` 

## Results | K-means clustering

## Results | K-means clustering
```{r, echo = FALSE, out.width="100%"}
include_graphics(here("results/07_plot_kmeans_center.png"))
``` 

## Results | K-means clustering
```{r, echo = FALSE, out.width="100%"}
include_graphics(here("results/07_plot_kmeans_scree.png"))
``` 

# Discussion and conclusion

## Discussion and conclusion

- Stage 3 and 4 patients differ in tumor size and acid phosphatase levels
- Most effective treatment is 1.0 mg estrogen
- Significant variables are tumor size, CVD, age, and weight index


